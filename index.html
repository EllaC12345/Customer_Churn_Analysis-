<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Churn Analysis Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #111;
            color: white;
            font-family: 'Times New Roman', serif;
        }
        .container {
            max-width: 1200px;
            margin: auto;
        }
        h1, h2 {
            text-align: center;
            margin-top: 2rem;
        }
        .plot {
            width: 100%;
            height: 600px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Customer Churn Analysis Dashboard</h1>
        <p>A dashboard identifying customers likely to churn, accompanied by exploratory analysis that provides insights into the dataset and offers recommendations to help prevent churn.</p>
        
        <div id="churn-rate-by-tenure" class="plot"></div>
        <div id="churn-rate-by-total-charges-contract" class="plot"></div>
        <div id="churn-rate-by-categorical-drivers" class="plot"></div>
        
        <h2>Conclusion and Recommendations</h2>
        <div class="accordion" id="accordionExample">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        Conclusion
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        From the exploratory analysis and the review of feature importance from the Decision Tree Classifier, it is evident that customers with a tenure of 40 days or less and those who subscribe to monthly contracts are more likely to churn. Additional factors contributing to churn include:
                        <ul>
                            <li>Demographics: Senior citizens and customers without dependents.</li>
                            <li>Lack of Subscriptions: Customers not subscribing to add-on services such as device protection plans, online backups, and tech support.</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingTwo">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        Recommendations
                    </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                    <div class="accordion-body">
                        <ul>
                            <li><strong>Develop Comprehensive Contract Plans with Enhanced Add-On Services for Data and Voice Customers:</strong>
                                <ul>
                                    <li>Create mid to long-term contract plans that include valuable add-on services to incentivize customers to commit for longer periods. Add-on services include:</li>
                                    <ul>
                                        <li>Online backup and tech support for internet subscribers.</li>
                                        <li>Device protection plans for voice customers.</li>
                                        <li>Enhanced movie and TV streaming offerings through partnership with local services.</li>
                                    </ul>
                                </ul>
                            </li>
                            <li><strong>Develop and Conduct Targeted Marketing Campaigns:</strong>
                                <ul>
                                    <li>Personalize communication strategies for customers without dependents and address the needs and concerns of senior Citizens who are likely to churn.</li>
                                    <li>Promote enhanced services developed in recommendation 1 and the benefits of long-term contracts.</li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <p>Download the strategy to optimize retention for customers who are more likely than not to churn.</p>
            <a href="recommendation.csv" download class="btn btn-primary">Download Strategy</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load and parse the CSV data
        Papa.parse("churn_prediction_df.csv", {
            download: true,
            header: true,
            complete: function(results) {
                const data = results.data;
                
                // Create Churn Rate by Tenure plot
                const churnByTenure = data.filter(d => d.Predicted_Churn === "Yes").map(d => ({
                    x: +d.tenure,
                    y: +d.Churn_Rate,
                    text: d.customerID
                }));
                
                Plotly.newPlot('churn-rate-by-tenure', [{
                    type: 'scatter',
                    mode: 'markers',
                    x: churnByTenure.map(d => d.x),
                    y: churnByTenure.map(d => d.y),
                    text: churnByTenure.map(d => d.text),
                    marker: {
                        color: churnByTenure.map(d => d.y),
                        colorscale: 'IceFire',
                        size: 12
                    }
                }], {
                    title: 'Customer Tenure vs Churn Rate',
                    xaxis: { title: 'Tenure' },
                    yaxis: { title: 'Churn Rate' },
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    font: { color: 'white' }
                });
                
                // Create Churn Rate by Total Charges and Contract plot
                const contracts = ['Month-to-month', 'One year', 'Two year'];
                const churnByChargesContract = contracts.map(contract => {
                    const filteredData = data.filter(d => d.Predicted_Churn === "Yes" && d.Contract === contract);
                    return {
                        x: filteredData.map(d => +d.TotalCharges),
                        y: filteredData.map(d => +d.Churn_Rate),
                        text: filteredData.map(d => d.customerID),
                        mode: 'markers',
                        type: 'scatter',
                        name: contract,
                        marker: {
                            color: filteredData.map(d => +d.Churn_Rate),
                            colorscale: 'IceFire'
                        }
                    };
                });
                
                Plotly.newPlot('churn-rate-by-total-charges-contract', churnByChargesContract, {
                    title: 'Total Charges vs Churn Rate by Contract Type',
                    xaxis: { title: 'Total Charges' },
                    yaxis: { title: 'Churn Rate' },
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    font: { color: 'white' }
                });
                
                // Create Churn Rate by Categorical Drivers plot
                const categoricalColumns = ['gender', 'SeniorCitizen', 'Partner', 'Dependents', 'PhoneService', 'MultipleLines', 'InternetService', 'OnlineSecurity', 'OnlineBackup', 'DeviceProtection', 'TechSupport', 'StreamingTV', 'StreamingMovies', 'Contract', 'PaperlessBilling', 'PaymentMethod'];
                
                const churnByCategorical = categoricalColumns.map(col => {
                    const groupedData = data.reduce((acc, cur) => {
                        if (!acc[cur[col]]) {
                            acc[cur[col]] = { count: 0, churnSum: 0 };
                        }
                        acc[cur[col]].count++;
                        acc[cur[col]].churnSum += +cur.Churn_Rate;
                        return acc;
                    }, {});
                    
                    const categories = Object.keys(groupedData);
                    return {
                        x: categories,
                        y: categories.map(cat => groupedData[cat].churnSum / groupedData[cat].count),
                        type: 'bar',
                        name: col,
                        text: categories.map(cat => groupedData[cat].count),
                        marker: {
                            color: categories.map(cat => groupedData[cat].churnSum / groupedData[cat].count),
                            colorscale: 'Bluered'
                        }
                    };
                });
                
                Plotly.newPlot('churn-rate-by-categorical-drivers', churnByCategorical, {
                    title: 'Avg Churn Rate by Categorical Drivers',
                    xaxis: { title: 'Categories' },
                    yaxis: { title: 'Avg Churn Rate' },
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    font: { color: 'white' },
                    showlegend: false,
                    grid: { rows: 4, columns: 4, pattern: 'independent' }
                });
            }
        });
    </script>
</body>
</html>